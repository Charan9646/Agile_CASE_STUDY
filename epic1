<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TeleCare — Online Consultation Booking (Epic 1)</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

    <style>
      body { background: #f8f9fa; }
      .card-doctor { border: 0; border-radius: 12px; box-shadow: 0 6px 20px rgba(15,23,42,0.06); }
      .health-grid { display:flex; flex-wrap:wrap; gap:0.5rem; }
      .health-grid .form-check { min-width: 160px; }
    </style>
  </head>
  <body>
    <div class="container py-5">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="h5 mb-0">Available Doctors</h3>
        <button class="btn btn-outline-primary" id="openBookingBtn" data-bs-toggle="modal" data-bs-target="#bookModal">
          <i class="bi bi-calendar-check me-1"></i> Book Visit
        </button>
      </div>

      <!-- Doctors grid (each card includes data-specialty attribute used to populate specialty dropdown) -->
      <div class="row g-3" id="doctorsGrid">
        <div class="col-6 col-md-4 col-lg-3">
          <div class="card card-doctor p-3" data-specialty="General Physician">
            <div class="d-flex gap-3 align-items-center">
              <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="Dr Patel" class="rounded-circle" width="64" height="64" />
              <div>
                <h6 class="mb-0">Dr. Amit Patel</h6>
                <small class="text-muted">General Physician • 10 yrs</small>
                <div class="mt-2">
                  <button class="btn btn-sm btn-outline-primary btn-book">Book</button>
                  <a href="#" class="btn btn-sm btn-link">Profile</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-6 col-md-4 col-lg-3">
          <div class="card card-doctor p-3" data-specialty="Pediatrician">
            <div class="d-flex gap-3 align-items-center">
              <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="Dr Sharma" class="rounded-circle" width="64" height="64" />
              <div>
                <h6 class="mb-0">Dr. Neha Sharma</h6>
                <small class="text-muted">Pediatrician • 7 yrs</small>
                <div class="mt-2">
                  <button class="btn btn-sm btn-outline-primary btn-book">Book</button>
                  <a href="#" class="btn btn-sm btn-link">Profile</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-6 col-md-4 col-lg-3">
          <div class="card card-doctor p-3" data-specialty="Dermatologist">
            <div class="d-flex gap-3 align-items-center">
              <img src="https://randomuser.me/api/portraits/men/65.jpg" alt="Dr Khan" class="rounded-circle" width="64" height="64" />
              <div>
                <h6 class="mb-0">Dr. Imran Khan</h6>
                <small class="text-muted">Dermatologist • 12 yrs</small>
                <div class="mt-2">
                  <button class="btn btn-sm btn-outline-primary btn-book">Book</button>
                  <a href="#" class="btn btn-sm btn-link">Profile</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add more cards as needed; ensure data-specialty attribute present -->
      </div>
    </div>

    <!-- Booking modal (collects patient details + dynamic specialty + preferred date/time) -->
    <div class="modal fade" id="bookModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Book Tele-Consultation</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="bookingForm" novalidate>
              <!-- Full name -->
              <div class="mb-3">
                <label class="form-label">Full name</label>
                <input type="text" class="form-control" id="name" required />
              </div>

              <!-- Age -->
              <div class="mb-3">
                <label class="form-label">Age</label>
                <input type="number" min="0" step="1" class="form-control" id="age" placeholder="e.g. 29" required />
              </div>

              <!-- Gender -->
              <div class="mb-3">
                <label class="form-label d-block">Gender</label>
                <div class="d-flex gap-3">
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="genderMale" value="Male" required>
                    <label class="form-check-label" for="genderMale">Male</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="genderFemale" value="Female">
                    <label class="form-check-label" for="genderFemale">Female</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="gender" id="genderOther" value="Other">
                    <label class="form-check-label" for="genderOther">Other</label>
                  </div>
                </div>
              </div>

              <!-- Blood group -->
              <div class="mb-3">
                <label class="form-label">Blood group</label>
                <select class="form-select" id="bloodGroup" required>
                  <option value="" disabled selected>— Select blood group —</option>
                  <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
                  <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
                </select>
              </div>

              <!-- Health conditions -->
              <div class="mb-3">
                <label class="form-label d-block">Health conditions (check all that apply)</label>
                <div class="health-grid">
                  <div class="form-check">
                    <input class="form-check-input health-condition" type="checkbox" id="condDiabetic" value="Diabetic">
                    <label class="form-check-label" for="condDiabetic">Diabetic</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input health-condition" type="checkbox" id="condBP" value="High blood pressure">
                    <label class="form-check-label" for="condBP">High blood pressure</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input health-condition" type="checkbox" id="condHeart" value="Heart disease">
                    <label class="form-check-label" for="condHeart">Heart disease</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input health-condition" type="checkbox" id="condAsthma" value="Asthma">
                    <label class="form-check-label" for="condAsthma">Asthma</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input health-condition" type="checkbox" id="condNone" value="None">
                    <label class="form-check-label" for="condNone">None</label>
                  </div>
                </div>
              </div>

              <!-- Patient group -->
              <div class="mb-3">
                <label class="form-label">Patient group</label>
                <select class="form-select" id="patientGroup" required>
                  <option value="" disabled selected>— Select group —</option>
                  <option>Adult</option><option>Child</option><option>Senior</option><option>Pregnant</option><option>Other</option>
                </select>
              </div>

              <!-- Contact email -->
              <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" id="email" required />
              </div>

              <!-- Dynamic specialty select (populated from doctors grid) -->
              <div class="mb-3">
                <label class="form-label">Select specialty</label>
                <select class="form-select" id="specialty" required>
                  <!-- options injected by JS -->
                </select>
              </div>

              <!-- Preferred date & time -->
              <div class="mb-3">
                <label class="form-label">Preferred date & time</label>
                <input type="datetime-local" class="form-control" id="dt" required />
              </div>

              <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Confirm</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // collect unique specialties from doctor cards
      function collectSpecialties() {
        const set = new Set();
        document.querySelectorAll('.card-doctor[data-specialty]').forEach(card=>{
          const s = (card.getAttribute('data-specialty') || '').trim();
          if (s) set.add(s);
        });
        return Array.from(set).sort();
      }

      // populate specialty <select>
      function populateSpecialtySelect() {
        const sel = document.getElementById('specialty');
        if (!sel) return;
        const specs = collectSpecialties();
        sel.innerHTML = '';
        if (specs.length === 0) {
          const opt = document.createElement('option');
          opt.value = '';
          opt.textContent = 'No specialties available';
          opt.disabled = true;
          sel.appendChild(opt);
          return;
        }
        const placeholder = document.createElement('option');
        placeholder.value = '';
        placeholder.textContent = '— Select a specialty —';
        placeholder.disabled = true;
        placeholder.selected = true;
        sel.appendChild(placeholder);
        specs.forEach(s=>{
          const o = document.createElement('option');
          o.value = s; o.textContent = s;
          sel.appendChild(o);
        });
      }

      // health conditions logic (None vs others)
      function setupHealthLogic() {
        const none = document.getElementById('condNone');
        const checks = Array.from(document.querySelectorAll('.health-condition'));
        if (!none) return;
        function noneChanged() {
          if (none.checked) checks.forEach(cb => { if (cb !== none) { cb.checked = false; cb.disabled = true; }});
          else checks.forEach(cb => { if (cb !== none) cb.disabled = false; });
        }
        function otherChanged(e) {
          if (e.target.checked) { none.checked = false; none.disabled = true; }
          else {
            const any = checks.some(cb => cb !== none && cb.checked);
            if (!any) none.disabled = false;
          }
        }
        none.addEventListener('change', noneChanged);
        checks.forEach(cb => { if (cb !== none) cb.addEventListener('change', otherChanged); });
      }

      // wire Book buttons on doctor cards to open modal and preselect specialty
      function wireDoctorBookButtons() {
        document.querySelectorAll('.btn-book').forEach(btn=>{
          btn.addEventListener('click', (e)=>{
            const card = e.target.closest('.card-doctor');
            const spec = card && card.getAttribute('data-specialty');
            populateSpecialtySelect();
            const sel = document.getElementById('specialty');
            // show modal
            const modalEl = document.getElementById('bookModal');
            const modal = bootstrap.Modal.getOrCreateInstance(modalEl);
            modal.show();
            // preselect if available
            if (spec && sel) {
              // wait a tick for options to exist
              setTimeout(()=>{
                const opt = Array.from(sel.options).find(o => o.value === spec);
                if (opt) { sel.value = spec; }
              }, 50);
            }
          });
        });
      }

      document.addEventListener('DOMContentLoaded', ()=>{
        populateSpecialtySelect();
        setupHealthLogic();
        wireDoctorBookButtons();

        // repopulate specialties when modal opens (keeps in sync)
        const bookModalEl = document.getElementById('bookModal');
        if (bookModalEl) bookModalEl.addEventListener('show.bs.modal', populateSpecialtySelect);

        // form submission (demo: client-side validation + alert)
        const bookingForm = document.getElementById('bookingForm');
        bookingForm && bookingForm.addEventListener('submit', function(e){
          e.preventDefault();
          const name = document.getElementById('name').value.trim();
          const age = parseInt(document.getElementById('age').value,10);
          const gender = (document.querySelector('input[name="gender"]:checked')||{}).value;
          const bloodGroup = document.getElementById('bloodGroup').value;
          const patientGroup = document.getElementById('patientGroup').value;
          const email = document.getElementById('email').value.trim();
          const specialty = document.getElementById('specialty').value;
          const dt = document.getElementById('dt').value;
          const health = Array.from(document.querySelectorAll('.health-condition')).filter(cb=>cb.checked).map(cb=>cb.value);
          const conditions = health.length ? health : ['None'];

          const errs = [];
          if (!name) errs.push('Full name required');
          if (!Number.isFinite(age) || age < 0) errs.push('Valid age required');
          if (!gender) errs.push('Gender required');
          if (!bloodGroup) errs.push('Blood group required');
          if (!patientGroup) errs.push('Patient group required');
          if (!email) errs.push('Email required');
          if (!specialty) errs.push('Specialty required');
          if (!dt) errs.push('Preferred date/time required');

          if (errs.length) { alert('Please fix:\n' + errs.join('\n')); return; }

          // hide modal
          const modal = bootstrap.Modal.getOrCreateInstance(bookModalEl);
          modal.hide();

          // demo confirmation (replace with API call in production)
          alert(
            `Appointment requested for ${name}\n\n`+
            `Age: ${age}\nGender: ${gender}\nBlood group: ${bloodGroup}\n`+
            `Group: ${patientGroup}\nConditions: ${conditions.join(', ')}\n`+
            `Specialty: ${specialty}\nWhen: ${new Date(dt).toLocaleString()}\n\n`+
            `Confirmation will be sent to ${email}.`
          );

          this.reset();
          // re-enable health checkboxes & refresh specialties placeholder
          document.querySelectorAll('.health-condition').forEach(cb=>cb.disabled=false);
          populateSpecialtySelect();
        });
      });
    </script>
  </body>
</html>
