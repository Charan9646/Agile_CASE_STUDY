<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TeleCare — Doctors (Epic 2)</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    body { background: #f8f9fa; }
    .card-doctor { border: 0; border-radius: 12px; box-shadow: 0 6px 20px rgba(15,23,42,0.06); }
    .avatar { width:72px; height:72px; object-fit:cover; border-radius:50%; }
    .controls { gap: .5rem; }
    .filter-pill { cursor: pointer; user-select:none; }
    .no-results { padding: 3rem 0; text-align:center; color:#6c757d; }
  </style>
</head>
<body>
  <main class="container py-5">
    <div class="d-flex align-items-center justify-content-between mb-4 flex-wrap">
      <h2 class="mb-2">Available Doctors</h2>

      <div class="d-flex controls align-items-center">
        <div class="input-group me-2">
          <span class="input-group-text"><i class="bi bi-search"></i></span>
          <input id="searchBox" type="search" class="form-control" placeholder="Search doctors by name">
        </div>

        <select id="specialtyFilter" class="form-select me-2" style="min-width:190px;">
          <option value="">All specialties</option>
        </select>

        <div class="dropdown">
          <button class="btn btn-outline-secondary dropdown-toggle" id="sortBtn" data-bs-toggle="dropdown" aria-expanded="false">
            Sort
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="sortBtn">
            <li><a class="dropdown-item sort-option" data-sort="name-asc" href="#">Name A → Z</a></li>
            <li><a class="dropdown-item sort-option" data-sort="exp-desc" href="#">Experience ↓</a></li>
            <li><a class="dropdown-item sort-option" data-sort="exp-asc" href="#">Experience ↑</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Specialty chips (optional quick filter) -->
    <div id="specialtyChips" class="mb-4 d-flex flex-wrap gap-2"></div>

    <!-- Doctors grid -->
    <div id="doctorsGrid" class="row g-3">
      <!-- Doctor card example: ensure data-* attributes for profile details -->
      <div class="col-12 col-md-6 col-lg-4">
        <article class="card card-doctor p-3 h-100" tabindex="0"
                 data-name="Dr. Amit Patel"
                 data-specialty="General Physician"
                 data-experience="10"
                 data-fee="₹500"
                 data-bio="Dr. Amit Patel is a General Physician with 10 years of experience in family medicine, acute care and preventive health."
                 data-languages="English, Hindi">
          <div class="d-flex gap-3 align-items-center">
            <img class="avatar" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Dr Amit Patel">
            <div class="flex-grow-1">
              <h5 class="mb-0">Dr. Amit Patel</h5>
              <small class="text-muted">General Physician • 10 yrs</small>
              <div class="mt-2">
                <button class="btn btn-sm btn-outline-primary btn-view-profile">View profile</button>
                <a class="btn btn-sm btn-link" href="#" aria-disabled="true">Contact</a>
              </div>
            </div>
            <div class="text-end">
              <small class="text-muted d-block">Fee</small>
              <strong>₹500</strong>
            </div>
          </div>
        </article>
      </div>

      <div class="col-12 col-md-6 col-lg-4">
        <article class="card card-doctor p-3 h-100" tabindex="0"
                 data-name="Dr. Neha Sharma"
                 data-specialty="Pediatrician"
                 data-experience="7"
                 data-fee="₹600"
                 data-bio="Dr. Neha Sharma is a pediatric specialist focusing on childhood vaccinations, nutrition and acute pediatric care."
                 data-languages="English, Hindi">
          <div class="d-flex gap-3 align-items-center">
            <img class="avatar" src="https://randomuser.me/api/portraits/women/44.jpg" alt="Dr Neha Sharma">
            <div class="flex-grow-1">
              <h5 class="mb-0">Dr. Neha Sharma</h5>
              <small class="text-muted">Pediatrician • 7 yrs</small>
              <div class="mt-2">
                <button class="btn btn-sm btn-outline-primary btn-view-profile">View profile</button>
                <a class="btn btn-sm btn-link" href="#" aria-disabled="true">Contact</a>
              </div>
            </div>
            <div class="text-end">
              <small class="text-muted d-block">Fee</small>
              <strong>₹600</strong>
            </div>
          </div>
        </article>
      </div>

      <div class="col-12 col-md-6 col-lg-4">
        <article class="card card-doctor p-3 h-100" tabindex="0"
                 data-name="Dr. Imran Khan"
                 data-specialty="Dermatologist"
                 data-experience="12"
                 data-fee="₹700"
                 data-bio="Dr. Imran Khan is an experienced dermatologist treating acne, eczema, psoriasis and cosmetic dermatology cases."
                 data-languages="English, Urdu">
          <div class="d-flex gap-3 align-items-center">
            <img class="avatar" src="https://randomuser.me/api/portraits/men/65.jpg" alt="Dr Imran Khan">
            <div class="flex-grow-1">
              <h5 class="mb-0">Dr. Imran Khan</h5>
              <small class="text-muted">Dermatologist • 12 yrs</small>
              <div class="mt-2">
                <button class="btn btn-sm btn-outline-primary btn-view-profile">View profile</button>
                <a class="btn btn-sm btn-link" href="#" aria-disabled="true">Contact</a>
              </div>
            </div>
            <div class="text-end">
              <small class="text-muted d-block">Fee</small>
              <strong>₹700</strong>
            </div>
          </div>
        </article>
      </div>

      <!-- Add more doctor cards as needed; keep the data-* attributes consistent -->
      <div class="col-12 col-md-6 col-lg-4">
        <article class="card card-doctor p-3 h-100" tabindex="0"
                 data-name="Dr. Suresh Rao"
                 data-specialty="Cardiologist"
                 data-experience="15"
                 data-fee="₹1000"
                 data-bio="Cardiologist focusing on coronary artery disease, hypertension and heart failure management."
                 data-languages="English, Hindi">
          <div class="d-flex gap-3 align-items-center">
            <img class="avatar" src="https://randomuser.me/api/portraits/men/12.jpg" alt="Dr Suresh Rao">
            <div class="flex-grow-1">
              <h5 class="mb-0">Dr. Suresh Rao</h5>
              <small class="text-muted">Cardiologist • 15 yrs</small>
              <div class="mt-2">
                <button class="btn btn-sm btn-outline-primary btn-view-profile">View profile</button>
                <a class="btn btn-sm btn-link" href="#" aria-disabled="true">Contact</a>
              </div>
            </div>
            <div class="text-end">
              <small class="text-muted d-block">Fee</small>
              <strong>₹1000</strong>
            </div>
          </div>
        </article>
      </div>

      <!-- (More cards can be added here) -->
    </div>

    <div id="noResults" class="no-results d-none">
      <p class="lead mb-0">No doctors found that match your search/filter.</p>
    </div>
  </main>

  <!-- Profile modal (doctor details) -->
  <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="profileName" class="modal-title">Doctor Name</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-4 text-center">
              <img id="profileAvatar" src="" alt="" class="img-fluid rounded-circle" style="width:140px;height:140px;object-fit:cover;">
              <div class="mt-3">
                <strong id="profileFee">₹0</strong>
                <div class="text-muted small">consultation fee</div>
              </div>
            </div>

            <div class="col-md-8">
              <p id="profileSpecialty" class="mb-1 text-muted"></p>
              <p id="profileExperience" class="mb-2 text-muted"></p>

              <h6>About</h6>
              <p id="profileBio" class="small text-muted"></p>

              <h6 class="mt-3">Languages</h6>
              <p id="profileLanguages" class="small text-muted mb-3"></p>

              <div class="d-flex gap-2">
                <!-- NOTE: 'Request Appointment' intentionally does NOT implement Epic 1 booking modal.
                     It links to a placeholder or external appointment flow if you have one. -->
                <a id="requestApptLink" class="btn btn-primary" href="#contact" role="button">Request Appointment</a>
                <a id="viewFullProfile" class="btn btn-outline-secondary" href="#" role="button">Open full profile</a>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer text-muted small">
          <span>Verified • Licensed practitioner</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Epic 2: Doctor Management & Profiles - client-side functionality
    (function(){
      const doctorsGrid = document.getElementById('doctorsGrid');
      const searchBox = document.getElementById('searchBox');
      const specialtyFilter = document.getElementById('specialtyFilter');
      const specialtyChips = document.getElementById('specialtyChips');
      const noResults = document.getElementById('noResults');

      // collect unique specialties from cards
      function collectSpecialties() {
        const set = new Set();
        doctorsGrid.querySelectorAll('.card-doctor').forEach(card => {
          const s = (card.dataset.specialty || '').trim();
          if (s) set.add(s);
        });
        return Array.from(set).sort();
      }

      // populate filter select + chips
      function populateSpecialtyControls() {
        const specs = collectSpecialties();
        // select
        specialtyFilter.innerHTML = '<option value="">All specialties</option>';
        specs.forEach(s => {
          const opt = document.createElement('option');
          opt.value = s; opt.textContent = s;
          specialtyFilter.appendChild(opt);
        });
        // chips
        specialtyChips.innerHTML = '';
        const allChip = document.createElement('div');
        allChip.className = 'badge bg-light text-dark filter-pill px-3 py-2';
        allChip.textContent = 'All';
        allChip.dataset.value = '';
        specialtyChips.appendChild(allChip);
        specs.forEach(s => {
          const chip = document.createElement('div');
          chip.className = 'badge bg-white border filter-pill px-3 py-2';
          chip.textContent = s;
          chip.dataset.value = s;
          specialtyChips.appendChild(chip);
        });
      }

      // filter and search logic
      function applyFilterAndSearch() {
        const q = (searchBox.value || '').trim().toLowerCase();
        const specialty = specialtyFilter.value || '';
        const cards = Array.from(doctorsGrid.querySelectorAll('.card-doctor'));
        let visibleCount = 0;

        cards.forEach(card => {
          const name = (card.dataset.name || '').toLowerCase();
          const spec = (card.dataset.specialty || '');
          const matchesSearch = !q || name.includes(q);
          const matchesSpec = !specialty || spec === specialty;
          if (matchesSearch && matchesSpec) {
            card.closest('.col-12, .col-md-6, .col-lg-4').classList.remove('d-none');
            visibleCount++;
          } else {
            card.closest('.col-12, .col-md-6, .col-lg-4').classList.add('d-none');
          }
        });

        noResults.classList.toggle('d-none', visibleCount > 0);
      }

      // sort cards
      function sortCards(mode) {
        const container = doctorsGrid;
        const items = Array.from(container.children);
        // map to stable array with extracted values
        const mapped = items.map(col => {
          const card = col.querySelector('.card-doctor');
          const name = (card.dataset.name || '').toLowerCase();
          const exp = parseInt(card.dataset.experience || 0, 10);
          return { col, name, exp };
        });
        if (mode === 'name-asc') {
          mapped.sort((a,b)=> a.name.localeCompare(b.name));
        } else if (mode === 'exp-desc') {
          mapped.sort((a,b)=> b.exp - a.exp);
        } else if (mode === 'exp-asc') {
          mapped.sort((a,b)=> a.exp - b.exp);
        }
        // append in order
        mapped.forEach(m => container.appendChild(m.col));
      }

      // show profile modal and populate data
      function showProfile(cardEl) {
        const modalEl = document.getElementById('profileModal');
        const bsModal = new bootstrap.Modal(modalEl);
        document.getElementById('profileName').textContent = cardEl.dataset.name || 'Doctor';
        document.getElementById('profileAvatar').src = cardEl.querySelector('img')?.src || '';
        document.getElementById('profileSpecialty').textContent = cardEl.dataset.specialty || '';
        document.getElementById('profileExperience').textContent = (cardEl.dataset.experience ? cardEl.dataset.experience + ' years experience' : '');
        document.getElementById('profileFee').textContent = cardEl.dataset.fee || '';
        document.getElementById('profileBio').textContent = cardEl.dataset.bio || '';
        document.getElementById('profileLanguages').textContent = cardEl.dataset.languages || '';
        // placeholder 'Request Appointment' link - left for Epic 1 integration later
        document.getElementById('requestApptLink').href = '#contact';
        bsModal.show();
      }

      // event wiring
      document.addEventListener('DOMContentLoaded', function(){
        populateSpecialtyControls();
        applyFilterAndSearch();

        // search
        searchBox.addEventListener('input', applyFilterAndSearch);

        // select filter
        specialtyFilter.addEventListener('change', applyFilterAndSearch);

        // chips
        specialtyChips.addEventListener('click', function(e){
          const chip = e.target.closest('.filter-pill');
          if (!chip) return;
          const val = chip.dataset.value || '';
          // sync select
          specialtyFilter.value = val;
          // highlight active chip
          Array.from(specialtyChips.children).forEach(c => c.classList.toggle('bg-primary', c === chip));
          applyFilterAndSearch();
        });

        // sort options
        document.querySelectorAll('.sort-option').forEach(el=>{
          el.addEventListener('click', function(e){
            e.preventDefault();
            const mode = el.dataset.sort;
            sortCards(mode);
            applyFilterAndSearch();
          });
        });

        // profile buttons
        doctorsGrid.addEventListener('click', function(e){
          const btn = e.target.closest('.btn-view-profile');
          if (!btn) return;
          const card = btn.closest('.card-doctor');
          if (card) showProfile(card);
        });

        // keyboard accessible: enter on card opens profile
        doctorsGrid.addEventListener('keydown', function(e){
          if (e.key === 'Enter') {
            const card = e.target.closest('.card-doctor');
            if (card) showProfile(card);
          }
        });

        // simple live update: if admin adds/removes cards dynamically, controls can be refreshed
        // Expose a small helper for devs:
        window.refreshDoctorControls = function(){
          populateSpecialtyControls();
          applyFilterAndSearch();
        };
      });

    })();
  </script>
</body>
</html>
